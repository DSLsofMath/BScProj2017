<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Learn You a Physics for Great Good!</title>
    <link rel="stylesheet" type="text/css" href="../style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  </head>

  <body>
    <header>
      <a href="../index.html"><h1>Learn You a <span class="physics">Physics</span> for Great Good!</h1></a>
      <h1>&gt;&gt;&gt; WORK IN PROGRESS &lt;&lt;&lt;</h1>
      <h2>Dimensions / Testing of Quantity</h2>
      <nav>
	<span>[src: <a href="https://github.com/DSLsofMath/BScProj2018/blob/master/Physics/src/Dimensions/Quantity/Test.lhs">Dimensions/Quantity/Test.lhs</a>]</span>
        <span>Previous: <a href="../Dimensions/Quantities.html">Quantities</a></span>
        <a href="../index.html">Table of contents</a>
        <span>Next: <a href="../Dimensions/Usage.html">Usage</a></span>
      </nav>
    </header>

    <main>
      <h1 id="testing-of-quantity">Testing of Quantity</h1>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE DataKinds #-}</span>
<span class="ot">{-# LANGUAGE GADTs #-}</span>
<span class="ot">{-# LANGUAGE KindSignatures #-}</span>
<span class="ot">{-# LANGUAGE TypeFamilies #-}</span>
<span class="ot">{-# LANGUAGE UndecidableInstances #-}</span>
<span class="ot">{-# LANGUAGE TypeOperators #-}</span>
<span class="ot">{-# LANGUAGE FlexibleInstances #-}</span>
<span class="ot">{-# LANGUAGE TypeSynonymInstances #-}</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">module</span> <span class="dt">Dimensions.Quantity.Test</span>
( runTests
)
<span class="kw">where</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">import </span><span class="dt">Prelude</span> <span class="kw">hiding</span> (length, div)
<span class="kw">import </span><span class="dt">Test.QuickCheck</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">import </span><span class="dt">Dimensions.TypeLevel</span>
<span class="kw">import </span><span class="dt">Dimensions.Quantity</span></code></pre></div>
<p><code>Quantity</code> consists of a numerical type such as <code>Double</code> and a value-level dimension. Let's assume Haskell's implementation of numbers abide the laws. We also know the value-level dimensions abide the laws since since we tested them in a previous section. So what's there to test now? Well, it's still useful to test the top-level construct. And error may arise when combing different parts.</p>
<p>So let's test <em>some</em> things. Due to the type-level dimensions it's impossible to easily and readably design test for all combinations of dimensions. Hence it'll have to suffice with only some combinations.</p>
<h2 id="generating-arbitrary-quantities">Generating arbitrary quantities</h2>
<p>First we need an <code>Arbitrary</code> instance for <code>Quantity d val</code>. For <code>d</code> we'll mostly use <code>One</code> and for <code>val</code> we'll exclusively use <code>Double</code>.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">type</span> <span class="dt">Q</span> d <span class="fu">=</span> <span class="dt">Quantity</span> d <span class="dt">Double</span></code></pre></div>
<p>A generator for an arbitrary dimension.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">genQuantity ::</span> <span class="dt">Quantity</span> d <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Gen</span> (<span class="dt">Q</span> d)
genQuantity sugar <span class="fu">=</span> <span class="kw">do</span>
  value <span class="ot">&lt;-</span> arbitrary
  return (value <span class="fu">#</span> sugar)</code></pre></div>
<p>And now we make <code>Arbitrary</code> instances of arbitrary selected dimensions in the <code>Quantity</code>s.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">instance</span> <span class="dt">Arbitrary</span> (<span class="dt">Q</span> <span class="dt">One</span>) <span class="kw">where</span>
 arbitrary <span class="fu">=</span> genQuantity one</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">instance</span> <span class="dt">Arbitrary</span> (<span class="dt">Q</span> <span class="dt">Length</span>) <span class="kw">where</span>
  arbitrary <span class="fu">=</span> genQuantity length</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">instance</span> <span class="dt">Arbitrary</span> (<span class="dt">Q</span> <span class="dt">Mass</span>) <span class="kw">where</span>
  arbitrary <span class="fu">=</span> genQuantity mass</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">instance</span> <span class="dt">Arbitrary</span> (<span class="dt">Q</span> <span class="dt">Time</span>) <span class="kw">where</span>
  arbitrary <span class="fu">=</span> genQuantity time</code></pre></div>
<h2 id="testing-arithmetic-properties">Testing arithmetic properties</h2>
<p>One regular numbers, and hence too on quantites with their dimensions, a bunch of properties should hold. The things we test here are</p>
<ul>
<li>Addition commutative</li>
<li>Addition associative</li>
<li>Zero is identity for addition</li>
<li>Multiplication commutative</li>
<li>Multiplication associative</li>
<li>One is identity for multiplication</li>
<li>Addition distributes over multiplication</li>
<li>Subtraction and addition cancel each other out</li>
<li>Division and multiplication cancel each other out</li>
<li>Pythagoran trigonometric identity</li>
<li>The sugar doesn't care about input value</li>
</ul>
<p>Let's start!</p>
<p>We could write the type signatures in a general way like</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">prop_addCom ::</span> <span class="dt">Q</span> d <span class="ot">-&gt;</span> <span class="dt">Q</span> d <span class="ot">-&gt;</span> <span class="dt">Bool</span></code></pre></div>
<p>But we won't do that for two reasons.</p>
<ol style="list-style-type: decimal">
<li>QuickCheck needs concrete types in order to work. So we would have to do a bunch of specialization anyway. And even if we begin with a general signature, we can't cover all cases since there are infinitly many dimensions.</li>
<li>TODO: Går inte för vissa fall, t.ex.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="dt">Couldn&#39;t</span> match <span class="kw">type</span> <span class="ot">`Mul d (Mul d d)&#39; with `</span><span class="dt">Mul</span> (<span class="dt">Mul</span> d d) d&#39;</code></pre></div>
<p>Instead we'll pick some arbitrary dimensions that have an <code>Arbitrary</code> instance.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="co">-- a + b = b + a</span>
<span class="ot">prop_addCom ::</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
prop_addCom a b <span class="fu">=</span> (a <span class="fu">+#</span> b) <span class="fu">~=</span> (b <span class="fu">+#</span> a)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="co">-- a + (b + c) = (a + b) + c</span>
<span class="ot">prop_addAss ::</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
prop_addAss a b c <span class="fu">=</span> a <span class="fu">+#</span> (b <span class="fu">+#</span> c) <span class="fu">~=</span> (a <span class="fu">+#</span> b) <span class="fu">+#</span> c</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="co">-- 0 + a = a</span>
<span class="ot">prop_addId ::</span> <span class="dt">Q</span> <span class="dt">Time</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
prop_addId a <span class="fu">=</span> zero <span class="fu">+#</span> a <span class="fu">~=</span> a
  <span class="kw">where</span>
    <span class="co">-- `zero` will, thanks to the versatile suger, have &gt;     -- the same dimension as `a`.</span>
    zero <span class="fu">=</span> <span class="dv">0</span> <span class="fu">#</span> a</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="co">-- a * b = b * a</span>
<span class="ot">prop_mulCom ::</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
prop_mulCom a b <span class="fu">=</span> a <span class="fu">*#</span> b <span class="fu">~=</span> b <span class="fu">*#</span> a</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="co">-- a * (b * c) = (a * b) * c</span>
<span class="ot">prop_mulAss ::</span> <span class="dt">Q</span> <span class="dt">Time</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
prop_mulAss a b c <span class="fu">=</span> a <span class="fu">*#</span> (b <span class="fu">*#</span> c) <span class="fu">~=</span>
                    (a <span class="fu">*#</span> b) <span class="fu">*#</span> c</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="co">-- 1 * a = a</span>
<span class="ot">prop_mulId ::</span> <span class="dt">Q</span> <span class="dt">Time</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
prop_mulId a <span class="fu">=</span> (<span class="dv">1</span> <span class="fu">#</span> one) <span class="fu">*#</span> a <span class="fu">~=</span> a</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="co">-- a * (b + c) = a * b + a * c</span>
<span class="ot">prop_addDistOverMul ::</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
prop_addDistOverMul a b c <span class="fu">=</span> a <span class="fu">*#</span> (b <span class="fu">+#</span> c) <span class="fu">~=</span>
                               a <span class="fu">*#</span> b <span class="fu">+#</span> a <span class="fu">*#</span> c</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="co">-- (a + b) - b = a</span>
<span class="ot">prop_addSubCancel ::</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
prop_addSubCancel a b <span class="fu">=</span> (a <span class="fu">+#</span> b) <span class="fu">-#</span> b <span class="fu">~=</span> a</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="co">-- (a * b) / b = a</span>
<span class="ot">prop_mulDivCancel ::</span> <span class="dt">Q</span> <span class="dt">Time</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Property</span>
prop_mulDivCancel a b <span class="fu">=</span> not (isZero b) <span class="fu">==&gt;</span>
  (a <span class="fu">*#</span> b) <span class="fu">/#</span> b <span class="fu">~=</span> a</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="co">-- sin a * sin a + cos a * cos a = 1</span>
<span class="ot">prop_pythagoranIdentity ::</span> <span class="dt">Q</span> <span class="dt">One</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
prop_pythagoranIdentity a <span class="fu">=</span> sinq a <span class="fu">*#</span> sinq a <span class="fu">+#</span>
                            cosq a <span class="fu">*#</span> cosq a <span class="fu">~=</span> (<span class="dv">1</span> <span class="fu">#</span> one)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">prop_sugar ::</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
prop_sugar v a b <span class="fu">=</span> v <span class="fu">#</span> a <span class="fu">~=</span> v <span class="fu">#</span> b</code></pre></div>
<h2 id="integrating-tests-with-stack">Integrating tests with Stack</h2>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">runTests ::</span> <span class="dt">IO</span> ()
runTests <span class="fu">=</span> <span class="kw">do</span>
  putStrLn <span class="st">&quot;Dimensions quantity: Addition commutative&quot;</span>
  quickCheck prop_addCom
  putStrLn <span class="st">&quot;Dimensions quantity: Addition associative&quot;</span>
  quickCheck prop_addAss
  putStrLn <span class="st">&quot;Dimensions quantity: Zero is identity for addition&quot;</span>
  quickCheck prop_addId
  putStrLn <span class="st">&quot;Dimensions quantity: Multiplication commutative&quot;</span>
  quickCheck prop_mulCom
  putStrLn <span class="st">&quot;Dimensions quantity: Multiplication associative&quot;</span>
  quickCheck prop_mulAss
  putStrLn <span class="st">&quot;Dimensions quantity: One is identity for multiplication&quot;</span>
  quickCheck prop_mulId
  putStrLn <span class="st">&quot;Dimensions quantity: Addition distributes over multiplication&quot;</span>
  quickCheck prop_addDistOverMul
  putStrLn <span class="st">&quot;Dimensions quantity: Subtraction and addition cancel each other out&quot;</span>
  quickCheck prop_addSubCancel
  putStrLn <span class="st">&quot;Dimensions quantity: Division and multiplication cancel each other out&quot;</span>
  quickCheck prop_mulDivCancel
  putStrLn <span class="st">&quot;Dimensions quantity: Pythagoran trigonometric identity&quot;</span>
  quickCheck prop_pythagoranIdentity
  putStrLn <span class="st">&quot;Dimensions quantity: Sugar is correct&quot;</span>
  quickCheck prop_sugar</code></pre></div>

    </main>

    <footer>
      <nav>
	<span>[src: <a href="https://github.com/DSLsofMath/BScProj2018/blob/master/Physics/src/Dimensions/Quantity/Test.lhs">Dimensions/Quantity/Test.lhs</a>]</span>
        <span>Previous: <a href="../Dimensions/Quantities.html">Quantities</a></span>
        <a href="../index.html">Table of contents</a>
        <span>Next: <a href="../Dimensions/Usage.html">Usage</a></span>
      </nav>
      © Kandidatboisen (2018), GPL
    </footer>
  </body>
</html>
