<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Learn You a Physics for Great Good!</title>
    <link rel="stylesheet" type="text/css" href="../style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  </head>

  <body>
    <header>
      <a href="../index.html"><h1>Learn You a <span class="physics">Physics</span> for Great Good!</h1></a>
      <h1>&gt;&gt;&gt; WORK IN PROGRESS &lt;&lt;&lt;</h1>
      <nav>
	<span>[src: <a href="https://github.com/DSLsofMath/BScProj2018/blob/master/Physics/src/Dimensions/Quantity/Test.lhs">Dimensions/Quantity/Test.lhs</a>]</span>
        <span>Previous: <a href="../Dimensions/Quantities.html">Quantities</a></span>
        <a href="../index.html">Table of contents</a>
        <span>Next: <a href="../Dimensions/Usage.html">Usage</a></span>
      </nav>
    </header>

    <main>
      <h1 id="testing-of-quantity">Testing of Quantity</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ot">{-# LANGUAGE DataKinds #-}</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="ot">{-# LANGUAGE GADTs #-}</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="ot">{-# LANGUAGE KindSignatures #-}</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="ot">{-# LANGUAGE TypeFamilies #-}</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="ot">{-# LANGUAGE UndecidableInstances #-}</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="ot">{-# LANGUAGE TypeOperators #-}</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="ot">{-# LANGUAGE FlexibleInstances #-}</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="ot">{-# LANGUAGE TypeSynonymInstances #-}</span></a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">module</span> <span class="dt">Dimensions.Quantity.Test</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">( runTests</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">where</span></a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">import</span> <span class="dt">Prelude</span> <span class="kw">hiding</span> (length, div)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">import</span> <span class="dt">Test.QuickCheck</span></a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">import</span> <span class="dt">Dimensions.TypeLevel</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">import</span> <span class="dt">Dimensions.Quantity</span></a></code></pre></div>
<p><code>Quantity</code> consists of a numerical type such as <code>Double</code> and a value-level dimension. Let’s assume Haskell’s implementation of numbers abide the laws. We also know the value-level dimensions abide the laws since since we tested them in a previous section. So what’s there to test now? Well, it’s still useful to test the top-level construct. And error may arise when combing different parts.</p>
<p>So let’s test <em>some</em> things. Due to the type-level dimensions it’s impossible to easily and readably design test for all combinations of dimensions. Hence it’ll have to suffice with only some combinations.</p>
<h2 id="generating-arbitrary-quantities">Generating arbitrary quantities</h2>
<p>First we need an <code>Arbitrary</code> instance for <code>Quantity d val</code>. For <code>d</code> we’ll mostly use <code>One</code> and for <code>val</code> we’ll exclusively use <code>Double</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">type</span> <span class="dt">Q</span> d <span class="fu">=</span> <span class="dt">Quantity</span> d <span class="dt">Double</span></a></code></pre></div>
<p>A generator for an arbitrary dimension.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="ot">genQuantity ::</span> <span class="dt">Quantity</span> d <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Gen</span> (<span class="dt">Q</span> d)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">genQuantity sugar <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  value <span class="ot">&lt;-</span> arbitrary</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  return (value <span class="fu">#</span> sugar)</a></code></pre></div>
<p>And now we make <code>Arbitrary</code> instances of arbitrary selected dimensions in the <code>Quantity</code>s.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Arbitrary</span> (<span class="dt">Q</span> <span class="dt">One</span>) <span class="kw">where</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"> arbitrary <span class="fu">=</span> genQuantity one</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Arbitrary</span> (<span class="dt">Q</span> <span class="dt">Length</span>) <span class="kw">where</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  arbitrary <span class="fu">=</span> genQuantity length</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Arbitrary</span> (<span class="dt">Q</span> <span class="dt">Mass</span>) <span class="kw">where</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  arbitrary <span class="fu">=</span> genQuantity mass</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Arbitrary</span> (<span class="dt">Q</span> <span class="dt">Time</span>) <span class="kw">where</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  arbitrary <span class="fu">=</span> genQuantity time</a></code></pre></div>
<h2 id="testing-arithmetic-properties">Testing arithmetic properties</h2>
<p>One regular numbers, and hence too on quantites with their dimensions, a bunch of properties should hold. The things we test here are</p>
<ul>
<li>Addition commutative</li>
<li>Addition associative</li>
<li>Zero is identity for addition</li>
<li>Multiplication commutative</li>
<li>Multiplication associative</li>
<li>One is identity for multiplication</li>
<li>Addition distributes over multiplication</li>
<li>Subtraction and addition cancel each other out</li>
<li>Division and multiplication cancel each other out</li>
<li>Pythagoran trigonometric identity</li>
<li>The sugar doesn’t care about input value</li>
</ul>
<p>Let’s start!</p>
<p>We could write the type signatures in a general way like</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="ot">prop_addCom ::</span> <span class="dt">Q</span> d <span class="ot">-&gt;</span> <span class="dt">Q</span> d <span class="ot">-&gt;</span> <span class="dt">Bool</span></a></code></pre></div>
<p>But we won’t do that for two reasons.</p>
<ol type="1">
<li>QuickCheck needs concrete types in order to work. So we would have to do a bunch of specialization anyway. And even if we begin with a general signature, we can’t cover all cases since there are infinitly many dimensions.</li>
<li>TODO: Går inte för vissa fall, t.ex.</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="dt">Couldn&#39;t</span> match <span class="kw">type</span> <span class="ot">`Mul d (Mul d d)&#39; with `</span><span class="dt">Mul</span> (<span class="dt">Mul</span> d d) d&#39;</a></code></pre></div>
<p>Instead we’ll pick some arbitrary dimensions that have an <code>Arbitrary</code> instance.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">-- a + b = b + a</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="ot">prop_addCom ::</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">prop_addCom a b <span class="fu">=</span> (a <span class="fu">+#</span> b) <span class="fu">~=</span> (b <span class="fu">+#</span> a)</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co">-- a + (b + c) = (a + b) + c</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="ot">prop_addAss ::</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3">prop_addAss a b c <span class="fu">=</span> a <span class="fu">+#</span> (b <span class="fu">+#</span> c) <span class="fu">~=</span> (a <span class="fu">+#</span> b) <span class="fu">+#</span> c</a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co">-- 0 + a = a</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="ot">prop_addId ::</span> <span class="dt">Q</span> <span class="dt">Time</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">prop_addId a <span class="fu">=</span> zero <span class="fu">+#</span> a <span class="fu">~=</span> a</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">    <span class="co">-- `zero` will, thanks to the versatile suger, have &gt;     -- the same dimension as `a`.</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">    zero <span class="fu">=</span> <span class="dv">0</span> <span class="fu">#</span> a</a></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co">-- a * b = b * a</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="ot">prop_mulCom ::</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">prop_mulCom a b <span class="fu">=</span> a <span class="fu">*#</span> b <span class="fu">~=</span> b <span class="fu">*#</span> a</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co">-- a * (b * c) = (a * b) * c</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="ot">prop_mulAss ::</span> <span class="dt">Q</span> <span class="dt">Time</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3">prop_mulAss a b c <span class="fu">=</span> a <span class="fu">*#</span> (b <span class="fu">*#</span> c) <span class="fu">~=</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">                    (a <span class="fu">*#</span> b) <span class="fu">*#</span> c</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co">-- 1 * a = a</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="ot">prop_mulId ::</span> <span class="dt">Q</span> <span class="dt">Time</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">prop_mulId a <span class="fu">=</span> (<span class="dv">1</span> <span class="fu">#</span> one) <span class="fu">*#</span> a <span class="fu">~=</span> a</a></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co">-- a * (b + c) = a * b + a * c</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="ot">prop_addDistOverMul ::</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Mass</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">prop_addDistOverMul a b c <span class="fu">=</span> a <span class="fu">*#</span> (b <span class="fu">+#</span> c) <span class="fu">~=</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4">                               a <span class="fu">*#</span> b <span class="fu">+#</span> a <span class="fu">*#</span> c</a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co">-- (a + b) - b = a</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="ot">prop_addSubCancel ::</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3">prop_addSubCancel a b <span class="fu">=</span> (a <span class="fu">+#</span> b) <span class="fu">-#</span> b <span class="fu">~=</span> a</a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co">-- (a * b) / b = a</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="ot">prop_mulDivCancel ::</span> <span class="dt">Q</span> <span class="dt">Time</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Property</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3">prop_mulDivCancel a b <span class="fu">=</span> not (isZero b) <span class="fu">==&gt;</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4">  (a <span class="fu">*#</span> b) <span class="fu">/#</span> b <span class="fu">~=</span> a</a></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co">-- sin a * sin a + cos a * cos a = 1</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="ot">prop_pythagoranIdentity ::</span> <span class="dt">Q</span> <span class="dt">One</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3">prop_pythagoranIdentity a <span class="fu">=</span> sinq a <span class="fu">*#</span> sinq a <span class="fu">+#</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4">                            cosq a <span class="fu">*#</span> cosq a <span class="fu">~=</span> (<span class="dv">1</span> <span class="fu">#</span> one)</a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="ot">prop_sugar ::</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Length</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">prop_sugar v a b <span class="fu">=</span> v <span class="fu">#</span> a <span class="fu">~=</span> v <span class="fu">#</span> b</a></code></pre></div>
<h2 id="integrating-tests-with-stack">Integrating tests with Stack</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="ot">runTests ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">runTests <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3">  putStrLn <span class="st">&quot;Dimensions quantity: Addition commutative&quot;</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">  quickCheck prop_addCom</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">  putStrLn <span class="st">&quot;Dimensions quantity: Addition associative&quot;</span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6">  quickCheck prop_addAss</a>
<a class="sourceLine" id="cb24-7" data-line-number="7">  putStrLn <span class="st">&quot;Dimensions quantity: Zero is identity for addition&quot;</span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8">  quickCheck prop_addId</a>
<a class="sourceLine" id="cb24-9" data-line-number="9">  putStrLn <span class="st">&quot;Dimensions quantity: Multiplication commutative&quot;</span></a>
<a class="sourceLine" id="cb24-10" data-line-number="10">  quickCheck prop_mulCom</a>
<a class="sourceLine" id="cb24-11" data-line-number="11">  putStrLn <span class="st">&quot;Dimensions quantity: Multiplication associative&quot;</span></a>
<a class="sourceLine" id="cb24-12" data-line-number="12">  quickCheck prop_mulAss</a>
<a class="sourceLine" id="cb24-13" data-line-number="13">  putStrLn <span class="st">&quot;Dimensions quantity: One is identity for multiplication&quot;</span></a>
<a class="sourceLine" id="cb24-14" data-line-number="14">  quickCheck prop_mulId</a>
<a class="sourceLine" id="cb24-15" data-line-number="15">  putStrLn <span class="st">&quot;Dimensions quantity: Addition distributes over multiplication&quot;</span></a>
<a class="sourceLine" id="cb24-16" data-line-number="16">  quickCheck prop_addDistOverMul</a>
<a class="sourceLine" id="cb24-17" data-line-number="17">  putStrLn <span class="st">&quot;Dimensions quantity: Subtraction and addition cancel each other out&quot;</span></a>
<a class="sourceLine" id="cb24-18" data-line-number="18">  quickCheck prop_addSubCancel</a>
<a class="sourceLine" id="cb24-19" data-line-number="19">  putStrLn <span class="st">&quot;Dimensions quantity: Division and multiplication cancel each other out&quot;</span></a>
<a class="sourceLine" id="cb24-20" data-line-number="20">  quickCheck prop_mulDivCancel</a>
<a class="sourceLine" id="cb24-21" data-line-number="21">  putStrLn <span class="st">&quot;Dimensions quantity: Pythagoran trigonometric identity&quot;</span></a>
<a class="sourceLine" id="cb24-22" data-line-number="22">  quickCheck prop_pythagoranIdentity</a>
<a class="sourceLine" id="cb24-23" data-line-number="23">  putStrLn <span class="st">&quot;Dimensions quantity: Sugar is correct&quot;</span></a>
<a class="sourceLine" id="cb24-24" data-line-number="24">  quickCheck prop_sugar</a></code></pre></div>

    </main>

    <footer>
      <nav>
	<span>[src: <a href="https://github.com/DSLsofMath/BScProj2018/blob/master/Physics/src/Dimensions/Quantity/Test.lhs">Dimensions/Quantity/Test.lhs</a>]</span>
        <span>Previous: <a href="../Dimensions/Quantities.html">Quantities</a></span>
        <a href="../index.html">Table of contents</a>
        <span>Next: <a href="../Dimensions/Usage.html">Usage</a></span>
      </nav>
      Licensed under the GPL by the Kandidatboisen (2018)
    </footer>
  </body>
</html>
